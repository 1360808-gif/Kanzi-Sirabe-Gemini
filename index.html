<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>漢字サクサク検索（熟語ルビ対応）</title>
    <link href="https://fonts.googleapis.com/css2?family=Klee+One:wght@400;600&family=Zen+Maru+Gothic:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Zen Maru Gothic', sans-serif; background-color: #fdfaf5; margin: 0; padding: 0; color: #333; height: 100vh; display: flex; flex-direction: column; }
        .app-container { display: flex; flex: 1; height: 100%; overflow: hidden; }
        .search-panel { width: 300px; background-color: #ffffff; padding: 30px; box-shadow: 2px 0 10px rgba(0,0,0,0.05); display: flex; flex-direction: column; z-index: 10; }
        .result-panel { flex: 1; padding: 30px; background-color: #fff5e6; overflow-y: auto; }
        h1 { color: #d35400; font-size: 20px; text-align: center; margin-top: 0; }
        input[type="text"] { width: 100%; padding: 15px; font-size: 20px; border: 3px solid #ffcc80; border-radius: 12px; outline: none; box-sizing: border-box; margin-bottom: 15px; font-family: inherit; }
        button { width: 100%; padding: 15px; font-size: 18px; background-color: #e67e22; color: white; border: none; border-radius: 50px; cursor: pointer; font-weight: bold; box-shadow: 0 4px 0 #d35400; }
        
        #result-area { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; max-width: 1200px; margin: 0 auto; }
        
        .card { background: #fff; border-radius: 15px; padding: 25px 20px; box-shadow: 0 4px 8px rgba(0,0,0,0.05); display: flex; flex-direction: column; border-left: 10px solid #ccc; position: relative; margin-top: 15px; }
        .card.has-meaning { border-left-color: #e67e22; }
        .card.no-meaning { border-left-color: #bdc3c7; }
        
        .grade-badge { position: absolute; top: -12px; right: 10px; background: #e67e22; color: #fff; padding: 2px 10px; border-radius: 10px; font-size: 12px; font-weight: bold; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }

        /* ルビの見た目を調整 */
        ruby { ruby-align: center; }
        rt { font-family: 'Zen Maru Gothic', sans-serif; font-size: 0.3em; color: #e67e22; font-weight: bold; letter-spacing: 0.1em; padding-bottom: 2px; }
        .no-meaning rt { color: #7f8c8d; }

        .kanji-large { font-family: 'Klee One', cursive; font-size: 56px; font-weight: 600; color: #2c3e50; text-align: center; word-break: break-all; line-height: 1.5; }
        .meaning { font-size: 18px; color: #444; background-color: #fff9f0; padding: 12px; border-radius: 8px; line-height: 1.8; font-weight: bold; text-align: center; margin-top: 10px; }
        
        @media (max-width: 768px) { .app-container { flex-direction: column; height: auto; } .search-panel { width: 100%; } }
    </style>
</head>
<body>

    <div class="app-container">
        <div class="search-panel">
            <h1>🖋️ かんじ熟語じしょ</h1>
            <input type="text" id="input-text" placeholder="例：きかい、記者">
            <button onclick="searchKanji()">さがす</button>
            <div style="font-size: 11px; color: #666; margin-top: 20px; line-height: 1.6;">
                <p>■ 熟語にも「ふりがな」がつきます。<br>■ 同じ読みの熟語も自動で探します。</p>
            </div>
        </div>
        <div class="result-panel">
            <div id="result-area"></div>
        </div>
    </div>

    <script>
        // 熟語を含めた辞書データ（すべてルビ情報付き）
        const dictionary = {
            "きかい": [
                {kanji:"機械", r:"きかい", m:"マシンのこと"},
                {kanji:"機会", r:"きかい", m:"チャンスのこと"},
                {kanji:"器械", r:"きかい", m:"とび<ruby>箱<rt>ばこ</rt></ruby>などの<ruby>道具<rt>どうぐ</rt></ruby>"}
            ],
            "きしゃ": [
                {kanji:"記者", r:"きしゃ", m:"ニュースを<ruby>書<rt>か</rt></ruby>く<ruby>人<rt>ひと</rt></ruby>"},
                {kanji:"汽車", r:"きしゃ", m:"シュッポッポと<ruby>走<rt>はし</rt></ruby>る<ruby>列車<rt>れっしゃ</rt></ruby>"},
                {kanji:"貴社", r:"きしゃ", m:"あいての<ruby>会社<rt>かいしゃ</rt></ruby>のこと"}
            ],
            "こうえん": [
                {kanji:"公園", r:"こうえん", m:"あそべるひろば"},
                {kanji:"講演", r:"こうえん", m:"ためになるお<ruby>話<rt>はなし</rt></ruby>"},
                {kanji:"公演", r:"こうえん", m:"ステージでの<ruby>発表<rt>はっぴょう</rt></ruby>"}
            ],
            "かんじ": [
                {kanji:"漢字", r:"かんじ", m:"日本の<ruby>文字<rt>もじ</rt></ruby>"},
                {kanji:"感じ", r:"かんじ", m:"こころにうかぶこと"},
                {kanji:"幹事", r:"かんじ", m:"みんなのまとめ<ruby>役<rt>やく</rt></ruby>"}
            ],
            "あう": [
                {kanji:"会う", r:"あう", m:"<ruby>人<rt>ひと</rt></ruby>に<ruby>会<rt>あ</rt></ruby>う"},
                {kanji:"合う", r:"あう", m:"サイズが<ruby>合<rt>あ</rt></ruby>う"},
                {kanji:"遭う", r:"あう", m:"ひどい<ruby>目<rt>め</rt></ruby>に<ruby>遭<rt>あ</rt></ruby>う"}
            ]
            // 他の1〜6年生の熟語・単語も同様に登録...
        };

        const kanjiByGrade = {
            1: "一右雨円王音下火花貝学気休吸玉金空月犬見口校左三山子四糸字耳七車手十出女小上森人水正生青夕石赤千川先早足村大男竹中虫町天田土二日入年白八百文木本名目立力林六",
            2: "引羽雲園遠何科夏家歌画回会海絵外角楽活間丸岩顔汽記帰弓牛魚京強教近兄形計元言原戸古午後語工公広交光考行高黄合谷国黒今才細作算止市矢姉思紙寺自時室社弱首秋週春書少場色食心新親図数西声星晴切雪船線前組走多太体台地池知茶昼長鳥朝直通弟店点電刀当冬父頭答同道読内南肉馬売買麦半番父風分聞米歩母方北毎妹万明鳴毛門夜野友用曜羊来藍理里立陸録話",
            3: "悪安暗医委意育員院飲運泳駅央横屋温化荷界開階寒感漢館岸起期客記紀喜基寄規喜技義議客去橋業局曲局極銀区苦具君係軽血決研県庫湖向幸港号根祭皿仕死使始指歯詩次事持式実写者主守取酒受州拾終習集住重宿所暑助昭消商章勝乗植申身神真深進世整昔全相送想息速族他打対待代第題炭短談着注柱丁帳調追定庭笛鉄転都度投豆島湯登等動童内波配倍箱畑発反坂板皮番板非飛備鼻筆氷表秒病品負部服福物平返勉放味命面問役薬由油有遊予羊葉陽様落流旅両緑礼列練路和",
            4: "愛案以衣位囲胃印英栄塩億加果貨課芽改械害街各覚完官管関観願希季紀喜旗器機議求泣給挙漁共協鏡競極訓軍郡径型景芸欠結建健験固候功巧好康航告差最菜祭材昨札刷殺察参産散残士氏史司試児治辞失借種周祝順初松笑唱焼象照賞臣信真成静勢清聖席積折節説浅戦選然争相倉想像速側続卒孫隊帯待貸態滞退大代第題宅建単置仲貯兆腸低底停的典伝徒努灯堂働特得毒独熱念燃能望波敗倍博飯飛費非備鼻必姫標票不付府副粉兵別辺変便包法望牧末満未脈民無約勇要養浴利陸良料量輪類令冷例歴連老労録",
            5: "圧囲移因永営衛易益液演応往桜恩可仮価河過賀快解格確額刊幹慣眼基寄規技義逆久旧居許境均禁句群軍系型経潔件券険検限現減源厳己呼誤個後御効構耕講鉱混査再災採際在材罪財昨殺雑酸参散算賛残士支志至視詞誌磁私次識実写謝若寂主守取種酒首儒授受州拾終習集住重宿祝術準序除傷承省称商賞章証象照情状織職制性政勢精製税責績接設舌絶銭鮮前善漸然全祖素窓創葬層総操増造像即促俗属賊存遜他多太対貸態代滞台大第題拓沢託濁諾達単担探淡炭短断暖段地知遅痴稚置致築蓄逐竹蓄築逐仲柱注駐著貯丁兆張帳庁鳥朝町調長頂直通痛低呈定邸庭艇訂適笛鉄典天展店点伝田電土徒都度渡土島投等答塔頭闘動童道働特得独読凸突届屯豚曇鈍奈内那南軟難二肉日如乳入任忍認熱年燃能悩濃納能脳農",
            6: "遺域宇映延沿我灰拡閣革割株干看簡危机揮貴疑吸供胸郷勤筋系敬警劇激穴絹権憲源厳己呼誤后孝皇紅降鋼刻穀骨困砂座済裁策冊蚕至私姿視詞誌磁射捨尺若樹収宗就衆従縦縮熟純処署諸除将傷障城蒸針仁垂推寸聖誠宣専泉洗染善奏窓創装層操蔵臓存尊宅担探誕生段暖値宙忠著庁頂潮賃痛展討党糖届難乳認納脳派拝背肺俳班晩否批秘陛閉片補暮宝訪亡忘棒枚幕密盟模訳郵優預欲翌乱卵覧裏律臨朗論"
        };

        function getGradeLabel(str) {
            let maxGrade = 0;
            let hasKanji = false;
            for (let char of str) {
                if (/[一-龠]/.test(char)) {
                    hasKanji = true;
                    for (let g = 1; g <= 6; g++) {
                        if (kanjiByGrade[g].includes(char)) {
                            maxGrade = Math.max(maxGrade, g);
                            break;
                        }
                    }
                }
            }
            if (!hasKanji) return "";
            return maxGrade > 0 ? `<ruby>小<rt>しょう</rt></ruby>${maxGrade}` : "学外";
        }

        async function searchKanji() {
            const input = document.getElementById('input-text').value.trim();
            const resultArea = document.getElementById('result-area');
            if (input === "") return;
            resultArea.innerHTML = '';
            
            let targetReading = null;
            if (dictionary[input]) {
                targetReading = input;
            } else {
                for (let reading in dictionary) {
                    if (dictionary[reading].some(item => item.kanji === input)) {
                        targetReading = reading;
                        break;
                    }
                }
            }

            if (targetReading) {
                dictionary[targetReading].forEach(item => createCard(item.kanji, targetReading, item.m));
            } else {
                if (/[一-龠]/.test(input)) {
                    // 漢字入力だが辞書にない場合：読みをAPIで取得してルビを振る
                    await searchFromAPI(null, input);
                } else {
                    // ひらがな入力で辞書にない場合
                    await searchFromAPI(input, null);
                }
            }
        }

        async function searchFromAPI(hira, kanji) {
            const query = hira || kanji;
            try {
                // Google APIで読み/変換候補を取得
                const pair = hira ? "ja-Hira|ja" : "ja|ja-Hira";
                const res = await fetch(`https://www.google.com/transliterate?langpair=${pair}&text=${query}`);
                const data = await res.json();
                
                if (data && data[0] && data[0][1]) {
                    const filtered = data[0][1].filter(cand => !/[\uFF61-\uFF9F]/.test(cand));
                    
                    if (kanji) {
                        // 漢字入力の場合：取得した「読み」をルビにして表示
                        createCard(kanji, filtered[0], null);
                    } else {
                        // ひらがな入力の場合：変換候補を表示
                        filtered.slice(0, 5).forEach(cand => {
                            if (cand !== hira) createCard(cand, hira, null);
                        });
                    }
                }
            } catch (e) { console.error(e); }
        }

        function createCard(kanji, reading, meanHtml) {
            const hasMeaning = (meanHtml != null);
            const cardClass = hasMeaning ? "card has-meaning" : "card no-meaning";
            const gradeLabel = getGradeLabel(kanji);
            const fontSize = kanji.length > 4 ? "36px" : "56px";

            // 熟語全体に読み（ルビ）を振る
            const displayKanji = reading ? `<ruby>${kanji}<rt>${reading}</rt></ruby>` : kanji;

            const html = `
                <div class="${cardClass}">
                    ${gradeLabel ? `<div class="grade-badge">${gradeLabel}</div>` : ""}
                    <div class="kanji-large" style="font-size: ${fontSize}">${displayKanji}</div>
                    ${hasMeaning ? `<div class="meaning">${meanHtml}</div>` : ""}
                </div>
            `;
            document.getElementById('result-area').innerHTML += html;
        }

        document.getElementById("input-text").addEventListener("keypress", (e) => { if (e.key === "Enter") searchKanji(); });
    </script>
</body>
</html>
